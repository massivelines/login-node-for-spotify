<!DOCTYPE html>
<html>

<head>
  <title>Callback</title>
  <script>
  // console.log('callback');
  (function() {
    // add security for injected url regex
  var urlSplit = window.location.href.split('?');
  var data = {};

  for (var i=0; i<urlSplit.length; i++) {
    if (urlSplit[i].indexOf('=')>0) {
      var split = urlSplit[i].split('=');
      data[split[0]] = split[1];
    }
  }

  // console.log('initial hash', hash);
  if (data.code) {

    fetch('http://localhost:5000/callback', {
      method: 'POST',
      body: JSON.stringify(data),
      headers: {
        'Content-Type': 'application/json'
      }
    }).then(function(response) {
      if(response.status == 200) {
        window.close();
      }
      // console.log(response);
    }).catch(function(err) {
      // Error :(
      console.log(err);
      console.log('error');
    });


    // sends data to window that opended popup
    // window.opener.postMessage(JSON.stringify({
    //   type:'code',
    //   code: data.code
    //   // state : state
    // }), '*');
    // window.close();
  } else {
    // TODO: error
  }
})();


  </script>
</head>

<body>
</body>

</html>
