<!DOCTYPE html>
<html>

<head>
  <title>Callback</title>
  <script>
  // console.log('callback');
  (function() {
    // add security for injected url regex
  var urlSplit = window.location.href.split('?');
  urlSplit = urlSplit[1].split('&');
  var data = {};
  console.log(urlSplit);
  for (var i=0; i<urlSplit.length; i++) {
    if (urlSplit[i].indexOf('=')>0) {
      var split = urlSplit[i].split('=');
      data[split[0]] = split[1];
    }
  }
  console.log(data);
  // console.log('initial hash', hash);
  if (data.code) {

    fetch('http://localhost:5000/callback', {
      method: 'POST',
      body: JSON.stringify(data),
      headers: {
        'Content-Type': 'application/json'
      }
    }).then(function(response) {
      if(response.status == 200) {
        window.close();
      }
      // console.log(response);
    }).catch(function(err) {
      // Error :(
      console.log(err);
      console.log('error');
    });
  } else {
    // TODO: error
  }
})();

// TODO: loading screen?

  </script>
</head>

<body>
</body>

</html>
